<!DOCTYPE html>
<html>

<head>
  <title>Manage Connections</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

</head>

<body>
  <nav class="navbar">
    <div class="navbar-left">
      <a href="/" class="navbar-title" style="text-decoration:none;">Data Migration Tool</a>
    </div>
    <div class="navbar-right">
      <button type="button" id="manageConnectionsBtn" class="nav-btn">Manage Connections</button>
      <button type="button" id="manageSchedulesBtn" class="nav-btn">Manage Schedules</button>
      <button id="viewHistoryBtn" class="hist-btn" title="View Migration History">
        <span class="hist-btn-content">
          <svg class="hist-icon" width="22" height="22" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="9.5" stroke="#357cf9" stroke-width="2" />
            <path d="M12 7v5l3 2" stroke="#357cf9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <span class="hist-text">History</span>
        </span>
      </button>

      </button>
    </div>
  </nav>
  <div class="main-two-col">

    <!-- Left: Add Connection -->
    <div class="add-panel">
      <h2 style="margin-top:0;">Add Connection</h2>
      <form id="connForm" autocomplete="off">
        <label>Type:
          <select id="db_type" name="db_type" required>
            <option value="" disabled selected hidden>-- Select Database Type --</option>
            <option value="mysql">MySQL</option>
            <option value="oracle">Oracle</option>
            <option value="postgresql">PostgreSQL</option>
            <option value="sqlserver">SQL Server</option>
          </select>
        </label><br>
        <label>Connection Name: <input id="name" name="name" required autocomplete="new-password"></label>
        <div id="fields" style="margin:12px 0 13px 0;"></div>
        <div style="margin: 15px 0; padding: 12px; background: #f0f4ff; border-left: 3px solid #357cf9; border-radius: 4px;">
          <label style="display: block;">
            Default Preference:
            <select id="default_role" style="margin-top: 4px; padding: 6px; border: 1px solid #357cf9; border-radius: 4px;">
              <option value="" selected>No preference</option>
              <option value="source">Default source</option>
              <option value="destination">Default destination</option>
            </select>
          </label>
        </div>
        <button type="submit" class="btn btn-main">Save</button>
        <button type="button" id="resetConnBtn" class="btn">Reset</button>
        <button type="button" onclick="window.location='/'" class="btn">Back</button>
      </form>

      <!-- Batch Size Configuration Section -->
      <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
        <h2 style="margin-top:0;">Global Settings</h2>
        <form id="settingsForm">
          <label style="display: block; margin-bottom: 8px;">
            <strong>Batch Size:</strong>
            <input type="number" id="batch_size" name="batch_size" min="1000" max="10000000" 
                   style="width: 150px; margin-left: 10px;" required>
          </label>
          <div style="color: #666; font-size: 12px; margin-bottom: 15px; margin-left: 0;">
            Number of rows to process per batch (default: 100000)
          </div>
          <button type="submit" class="btn btn-main">Save Batch Size</button>
        </form>
        <div id="settingsMessage" style="margin-top: 10px; color: green; display: none;"></div>
      </div>
    </div>

    <!-- Right: Existing Connections Table -->
    <div class="existing-panel">
      <div class="existing-header">Connections</div>
      <table style="width:100%;" id="connTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Details</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody><!-- JS fills in --></tbody>
      </table>
    </div>
  </div>
  <script src="{{ url_for('static', filename='manage_connections.js') }}"></script>
  <script>
    let id = x => document.getElementById(x);
    if (id('manageConnectionsBtn')) id('manageConnectionsBtn').onclick = () => window.location = '/manage-connections';
    if (id('manageSchedulesBtn')) id('manageSchedulesBtn').onclick = () => window.location = '/schedules';
    if (id('viewHistoryBtn')) id('viewHistoryBtn').onclick = () => window.location = '/migration-history';
  </script>
</body>

</html>